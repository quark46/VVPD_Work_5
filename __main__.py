import math
import sys

menu_txt = ['"1" - Выполнить первую функцию',
            '"2" - Выполнить вторую функцию',
            '"3" - Выполнить третью функцию',
            '"4" - Завершить выполнение программы']
menu_error = 'Ошибка. Введите число в следующем диапазоне: [1, 4]'

def get_int(text, err_text, bounds=None):
    """
    Короткое описание:
    Запрашивает у пользователя ввод целого числа с проверкой на корректность

    Описание:
    Функция запрашивает у пользователя ввод целого числа. Если введенное значение не является целым числом, выводится сообщение об ошибке, и запрос повторяется. Также можно задать диапазон допустимых значений

    Аргументы:
    text (str or list of str): Сообщение, которое выводится перед запросом ввода
    err_text (str): Сообщение об ошибке, которое выводится, если введено некорректное значение
    bounds (list of int, optional): Список из двух чисел, задающих пределы вычислений

    Возвращаемое значение:
    int: Введенное пользователем целое число

    Исключения:
    ValueError: Генерируется, если введенные данные не могут быть преобразованы в целое число

    Примеры использования:
    1. get_int("Введите число:", "Ошибка ввода", [1, 10])  # Ввод числа от 1 до 10
    2. get_int("Введите ваш возраст:", "Ошибка ввода")  # Ввод любого целого числа
    """
    while True:
        if isinstance(text, list):
            print('')
            print(*text, sep='\n')
        else:
            print('')
            print(text)
        inp = input()
        print('')
        try:
            inp = int(inp)
        except ValueError:
            print(err_text)
        if isinstance(inp, int):
            if isinstance(bounds, list):
                if bounds[0] <= inp <= bounds[1]:
                    return int(inp)
                print(err_text)
            else:
                return int(inp)


def menu(text, err_txt, bounds):
    """
    Короткое описание:
    Отображает меню и запрашивает выбор пользователя с проверкой на корректность

    Описание:
    Функция выводит на экран меню и запрашивает у пользователя ввод числа, проверяя, что оно находится в пределах заданного диапазона. Если ввод некорректен, выводится сообщение об ошибке, и запрос повторяется

    Аргументы:
    text (list of str or str): Сообщение или список сообщений для отображения меню
    err_txt (str): Сообщение об ошибке, которое выводится при некорректном вводе
    bounds (list of int): Диапазон допустимых значений для ввода

    Возвращаемое значение:
    int: Выбор пользователя в виде целого числа

    Исключения:
    ValueError: Генерируется, если выбор пользователя выходит за пределы допустимого диапазона

    Примеры использования:
    1. menu(menu_txt, menu_error, [1, 4])  # Запрос выбора от 1 до 4
    """
    user_inp = get_int(text, err_txt, bounds)
    return user_inp


def sinh_taylor(x, terms=50):
    """
    Короткое описание:
    Вычисляет значение гиперболического синуса sinh(x) с использованием разложения в ряд Тейлора

    Описание:
    Функция вычисляет гиперболический синус числа x с помощью разложения в ряд Тейлора до заданного количества членов (по умолчанию 50). Ряд Тейлора для гиперболического синуса сходится для всех значений x

    Аргументы:
    x (float): Значение, для которого нужно вычислить sinh(x)
    terms (int, optional): Количество членов ряда Тейлора для вычисления

    Возвращаемое значение:
    float: Приближенное значение гиперболического синуса от x

    Примеры использования:
    1. sinh_taylor(1)  # Вычислит sinh(1) с использованием 50 членов ряда
    """

    sinh_x = 0
    for n in range(terms):
        term = (x ** (2 * n + 1)) / math.factorial(2 * n + 1)
        sinh_x += term

    return sinh_x


def arctan_taylor(x, terms=50):
    """
    Короткое описание:
    Вычисляет значение арктангенса arctan(x) с использованием разложения в ряд Тейлора

    Подробное описание:
    Функция вычисляет арктангенс числа x с помощью разложения в ряд Тейлора до заданного количества членов (по умолчанию 50). Ряд Тейлора для арктангенса сходится только при |x| <= 1. Если x выходит за этот предел, генерируется исключение

    Аргументы:
    x (float): Значение, для которого нужно вычислить arctan(x)
    terms (int, optional): Количество членов ряда Тейлора для вычисления

    Возвращаемое значение:
    float: Приближенное значение арктангенса от x

    Исключения:
    ValueError: Генерируется, если |x| > 1, так как ряд Тейлора не сходится для таких значений

    Примеры использования:
    1. arctan_taylor(0.5)  # Вычислит arctan(0.5) с использованием 50 членов ряда
    2. arctan_taylor(1)  # Вычислит arctan(1) с использованием 50 членов ряда
    3. arctan_taylor(2)  # Генерирует исключение ValueError, так как |2| > 1
    """

    if abs(x) > 1:
        raise ValueError("Ряд Тейлора для arctan(x) сходится только при |x| <= 1")
    
    arctan_x = 0
    for n in range(terms):
        term = ((-1)**n * x**(2*n + 1)) / (2*n + 1)
        arctan_x += term

    return arctan_x


def power_series(x, m, terms=50):
    """
    Вычисляет (1 - x)^m с использованием разложения в ряд Тейлора.

    Короткое описание:
    Реализация разложения (1 - x)^m = 1 - mx + m(m-1)x^2/2! - ... для заданного числа итераций.

    Описание:
    Функция вычисляет значение выражения (1 - x)^m с использованием ряда Тейлора.
    Граничное условие: -1 < x < 1. Количество итераций задается константой terms.

    Аргументы:
    x (float): Значение, для которого нужно вычислить (1 - x)^m.
    m (float): Степень, в которую возводится (1 - x).

    Возвращаемое значение:
    float: Приблизительное значение (1 - x)^m.

    Исключения:
    ValueError: Если x не в пределах (-1, 1).

    Примеры использования:
    #>>> power_series(0.5, 2)
    0.5625
    #>>> power_series(-0.5, 3)
    1.875
    """
    if not isinstance(x, (int, float)) or not isinstance(m, (int, float)):
        raise ValueError("x и m должны быть числами")
    if x <= -1 or x >= 1:
        raise ValueError("x должен быть в пределах (-1, 1)")

    result = 1
    term = 1
    for n in range(1, terms + 1):
        term *= -m * (x / n)
        m -= 1
        result += term
    return result


def main():
    """
    Короткое описание:
    Основная функция программы, реализующая меню и вызовы соответствующих функций

    Описание:
    Функция организует цикл, который предоставляет пользователю меню с возможностью выбора различных операций. В зависимости от выбора, она вызывает соответствующие функции и отображает результаты

    Примеры использования:
    Вызов функции main() запускает программу, где пользователь может выбрать одну из операций из меню
    """
    while True:
        user_choise = menu(menu_txt, menu_error, [1, 4])
        match user_choise:
            case 1:
                x = get_int('Введите Х', 'Ошибка ввода')
                print(f"sinh({x}) = {sinh_taylor(x)}")
            case 2:
                x = get_int('Введите Х', 'Ошибка ввода. Введите число в диапазаоне от -1 до 1', [-1, 1])
                approx_value = arctan_taylor(x)
                print(f"arctan({x}) (аппроксимация) = {approx_value}")
            case 3:
                try:
                    x = float(input("Введите x (-1 < x < 1): "))
                    m = float(input("Введите m: "))
                    print(f"Результат: (1 - {x})^{m} ≈ {power_series(x, m)}")
                except ValueError as e:
                    print(f"Ошибка: {e}")
            case 4:
                sys.exit()


if __name__ == "__main__":
    main()